<div class="helpers-header">
  <h2>Helpers</h2>
</div>
<div class="divider"></div>

<div class="helpers-toolbar">
  <div class="helpers-toolbar-actions">
    <!-- Sort -->
    <div class="icon-btn">
      <button mat-icon-button [matMenuTriggerFor]="sortMenu" class="menu-trigger">
        <i class="ph ph-arrows-down-up"></i>
      </button>
    </div>
    <mat-menu #sortMenu="matMenu" class="custom-sort-menu">
      <button
        mat-menu-item
        *ngFor="let option of sortOptions"
        (click)="selectSort(option.value)"
        [ngClass]="{ 'selected-sort': selectedSort === option.value }"
      >
        <span class="menu-option">
          {{ option.label }}
          <i *ngIf="selectedSort === option.value" class="ph ph-check"></i>
        </span>
      </button>
    </mat-menu>

    <!-- Filter -->
    <div class="icon-btn">
      <button
        mat-icon-button
        [matMenuTriggerFor]="filterMenu"
        #filterMenuTrigger="matMenuTrigger"
        class="menu-trigger"
      >
        <i class="ph ph-funnel"></i>
      </button>
    </div>
    <mat-menu #filterMenu="matMenu" [overlapTrigger]="false" class="filter-menu">
      <div matMenuContent (click)="$event.stopPropagation()">
        <h2 class="filter-title">Filter by</h2>

        <div class="filter-section">
          <div class="filter-header">
            <h3>Type of Services</h3>
            <button class="reset-btn" (click)="selectedServiceTypes = []">Reset</button>
          </div>
          <div class="dropdown">
            <div class="dropdown-trigger" (click)="toggleDropdown('services')">
              {{ getSelectedLabel(selectedServiceTypes, 'Type of Services') }}
              <i class="ph ph-caret-down"></i>
            </div>

            <div
              *ngIf="dropdownOpen === 'services'"
              class="custom-dropdown"
            >
              <div class="dropdown-option select-all">
                <input
                  type="checkbox"
                  [checked]="areAllSelected('services')"
                  (change)="toggleSelectAll('services')"
                  id="select_all_services"
                />
                <label
                  for="select_all_services"
                  class="option-label"
                >
                  Select All
                </label>
              </div>

              <div
                *ngFor="let option of allServiceTypes"
                class="dropdown-option"
              >
                <input
                  type="checkbox"
                  [checked]="selectedServiceTypes.includes(option)"
                  (change)="toggleOption(option, 'services')"
                  [id]="'service_' + option"
                />
                <label [for]="'service_' + option" class="option-label">
                  {{ option }}
                  <i *ngIf="selectedServiceTypes.includes(option)" class="ph ph-check"></i>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="filter-section">
          <div class="filter-header">
            <h3>Organization Names</h3>
            <button class="reset-btn" (click)="selectedOrganizations = []">Reset</button>
          </div>
          <div class="dropdown">
            <div class="dropdown-trigger" (click)="toggleDropdown('organizations')">
              {{ getSelectedLabel(selectedOrganizations, 'Organization Names') }}
              <i class="ph ph-caret-down"></i>
            </div>
            <div *ngIf="dropdownOpen === 'organizations'" class="custom-dropdown">
              <div class="dropdown-option select-all">
                <input
                  type="checkbox"
                  [checked]="areAllSelected('organizations')"
                  (change)="toggleSelectAll('organizations')"
                  id="select_all_organizations"
                />
                <label
                  for="select_all_organizations"
                  class="option-label"
                >
                  Select All
                </label>
              </div>

              <div
                *ngFor="let option of allOrganizations"
                class="dropdown-option"
              >
                <input
                  type="checkbox"
                  [checked]="selectedOrganizations.includes(option)"
                  (change)="toggleOption(option, 'organizations')"
                  [id]="'org_' + option"
                />
                <label [for]="'org_' + option" class="option-label">
                  {{ option }}
                  <i *ngIf="selectedOrganizations.includes(option)" class="ph ph-check"></i>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="divider"></div>
        <div class="filter-actions">
          <button mat-stroked-button color="warn" class="action-btn"
            (click)="resetFilters(); filterMenuTrigger.closeMenu()">Reset</button>
          <button mat-flat-button color="primary" class="apply-btn"
            (click)="applyFilters(); filterMenuTrigger.closeMenu()">Apply</button>
        </div>
      </div>
    </mat-menu>

    <!-- Calendar -->
    <button class="icon-btn p-btn">
      <i class="ph ph-calendar-blank"></i>
    </button>
  </div>

  <!-- Search -->
  <div class="search-box">
    <span class="search-icon">
      <i class="fas fa-search"></i>
    </span>
    <input
      type="text"
      (input)="onsearch($event)"
      placeholder="Name, Employee ID, Phone"
      class="search-input"
    />
  </div>

  <!-- Results -->
  <div *ngIf="showfilter && nofhelpers !== totalno(); else totalCount" class="results-count">
    {{ nofhelpers }} of {{ totalno() }} results
  </div>
  <ng-template #totalCount>
    <div class="results-count">
      {{ totalno() }} helpers
    </div>
  </ng-template>

  <!-- Export / Add -->
  <div class="toolbar-right">
    <button class="icon-btn">
      <i class="ph ph-download-simple"></i>
    </button>
    <button class="add-btn" (click)="onclick()">
      <i class="ph ph-plus"></i>
      <span>Add Helper</span>
    </button>
  </div>
</div>

<div class="helpers-layout">
  <div class="sidebar">
    <app-sidebar
      [allhelper]="allhelper() | searchhelper:searchText:['fullName','phno','employeeid']"
      (selectedhelper)="handleselect($event)"
      [sortType]="selectedSort"
      (lengthEmitted)="updateLength($event)"
    ></app-sidebar>
  </div>

  <main class="main-content">
    <ng-container *ngIf="selectedhelper">
      <app-helper-data [helper]="selectedhelper" class="helper-data"></app-helper-data>
    </ng-container>
  </main>
</div>
